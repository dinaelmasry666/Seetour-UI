{"ast":null,"code":"import { Validators } from '@angular/forms';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"@angular/forms\";\nimport * as i3 from \"@angular/common\";\nfunction UploadImagesComponent_div_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\"File size exceeded \", ctx_r0.maxFileSize, \" MB\");\n  }\n}\nfunction UploadImagesComponent_div_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\"Invalid file extensions. Allowed extensions: \", ctx_r1.allowedExtensions.join(\", \"), \"\");\n  }\n}\nfunction UploadImagesComponent_div_9_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵelement(1, \"img\", 6);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const image_r4 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"src\", image_r4.url, i0.ɵɵsanitizeUrl);\n  }\n}\nfunction UploadImagesComponent_div_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtemplate(1, UploadImagesComponent_div_9_div_1_Template, 2, 1, \"div\", 5);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r2.uploadedUrls);\n  }\n}\nexport class UploadImagesComponent {\n  constructor(http, formBuilder) {\n    this.http = http;\n    this.formBuilder = formBuilder;\n    this.fileInput = document.querySelector('#fileInput');\n    this.files = this.fileInput?.files;\n    this.maxFileSize = 1; // MB\n    this.allowedExtensions = [\".jpg\", \".jpeg\", \".png\", \".gif\", \".bmp\"];\n    this.fileSizeExceeded = false;\n    this.invalidExtensions = false;\n    this.uploadForm = this.formBuilder.group({\n      fileInput: ['', [Validators.required]]\n    });\n  }\n  onSubmit() {\n    const fileInput = document.querySelector('#fileInput');\n    const files = fileInput?.files;\n    if (!files) {\n      console.log('No Selected Files');\n      return;\n    }\n    const formData = new FormData();\n    for (let i = 0; i < files.length; i++) {\n      const file = files.item(i);\n      formData.append('files[]', file, file?.name);\n    }\n    this.http.post('https://localhost:7277/api/AzureImagesURL/UploadImages', formData).subscribe(result => {\n      console.log(result);\n      // Reset the form after successful upload\n      this.uploadForm.reset();\n    }, error => {\n      console.error(error);\n      // Display user-friendly error message here\n    });\n  }\n\n  fileSizeValidator() {\n    return control => {\n      const files = control.value;\n      if (files && files.length > 0) {\n        for (let i = 0; i < files.length; i++) {\n          const file = files[i];\n          if (file && file.size > this.maxFileSize * 1024 * 1024) {\n            this.fileSizeExceeded = true;\n            return {\n              'fileSizeExceeded': true\n            };\n          }\n        }\n      }\n      this.fileSizeExceeded = false;\n      return null;\n    };\n  }\n  fileExtensionValidator(allowedExtensions) {\n    return control => {\n      const files = control.value;\n      if (!files) {\n        return null;\n      }\n      for (const file of files) {\n        const fileName = file.name;\n        const fileExtension = fileName.split('.').pop()?.toLowerCase();\n        if (fileExtension && allowedExtensions.indexOf('.' + fileExtension) === -1) {\n          return {\n            invalidExtension: true\n          };\n        }\n      }\n      return null;\n    };\n  }\n  validateFiles() {\n    const fileInput = document.querySelector('#fileInput');\n    const files = fileInput?.files;\n    if (!files) {\n      return;\n    }\n    for (let i = 0; i < files.length; i++) {\n      const file = files.item(i);\n      const fileName = file?.name;\n      const fileSize = file?.size / 1024 / 1024; // Convert bytes to MB\n      const fileExtension = fileName?.split('.').pop()?.toLowerCase();\n      if (fileSize > this.maxFileSize) {\n        this.fileSizeExceeded = true;\n        return;\n      }\n      if (fileExtension && this.allowedExtensions.indexOf('.' + fileExtension) === -1) {\n        this.invalidExtensions = true;\n        return;\n      }\n    }\n    this.fileSizeExceeded = false;\n    this.invalidExtensions = false;\n  }\n}\nUploadImagesComponent.ɵfac = function UploadImagesComponent_Factory(t) {\n  return new (t || UploadImagesComponent)(i0.ɵɵdirectiveInject(i1.HttpClient), i0.ɵɵdirectiveInject(i2.FormBuilder));\n};\nUploadImagesComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: UploadImagesComponent,\n  selectors: [[\"app-upload-images\"]],\n  decls: 10,\n  vars: 5,\n  consts: [[3, \"formGroup\", \"ngSubmit\"], [\"for\", \"fileInput\"], [\"type\", \"file\", \"id\", \"fileInput\", \"name\", \"fileInput\", \"multiple\", \"\", \"formControlName\", \"fileInput\", 3, \"change\"], [4, \"ngIf\"], [\"type\", \"submit\", 3, \"disabled\"], [4, \"ngFor\", \"ngForOf\"], [3, \"src\"]],\n  template: function UploadImagesComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"form\", 0);\n      i0.ɵɵlistener(\"ngSubmit\", function UploadImagesComponent_Template_form_ngSubmit_0_listener() {\n        return ctx.onSubmit();\n      });\n      i0.ɵɵelementStart(1, \"div\")(2, \"label\", 1);\n      i0.ɵɵtext(3, \"Choose file:\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(4, \"input\", 2);\n      i0.ɵɵlistener(\"change\", function UploadImagesComponent_Template_input_change_4_listener() {\n        return ctx.validateFiles();\n      });\n      i0.ɵɵelementEnd();\n      i0.ɵɵtemplate(5, UploadImagesComponent_div_5_Template, 2, 1, \"div\", 3);\n      i0.ɵɵtemplate(6, UploadImagesComponent_div_6_Template, 2, 1, \"div\", 3);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(7, \"button\", 4);\n      i0.ɵɵtext(8, \"Submit\");\n      i0.ɵɵelementEnd()();\n      i0.ɵɵtemplate(9, UploadImagesComponent_div_9_Template, 2, 1, \"div\", 3);\n    }\n    if (rf & 2) {\n      i0.ɵɵproperty(\"formGroup\", ctx.uploadForm);\n      i0.ɵɵadvance(5);\n      i0.ɵɵproperty(\"ngIf\", ctx.fileSizeExceeded);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.invalidExtensions);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"disabled\", !ctx.uploadForm.valid);\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"ngIf\", ctx.uploadedUrls.length > 0);\n    }\n  },\n  dependencies: [i3.NgForOf, i3.NgIf, i2.ɵNgNoValidate, i2.DefaultValueAccessor, i2.NgControlStatus, i2.NgControlStatusGroup, i2.FormGroupDirective, i2.FormControlName],\n  encapsulation: 2\n});","map":{"version":3,"mappings":"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","names":["Validators","i0","UploadImagesComponent","constructor","http","formBuilder","document","querySelector","fileInput","files","uploadForm","group","required","onSubmit","console","log","formData","FormData","i","length","file","item","append","name","post","subscribe","result","reset","error","fileSizeValidator","control","value","size","maxFileSize","fileSizeExceeded","fileExtensionValidator","allowedExtensions","fileName","fileExtension","split","pop","toLowerCase","indexOf","invalidExtension","validateFiles","fileSize","invalidExtensions","selectors","decls","vars","consts","template","ctx"],"sourceRoot":"","sources":["D:\\ITI_Tasks\\MEAN\\Angular\\Day5\\SeetourUI\\src\\app\\component\\upload-images\\upload-images.component.ts","D:\\ITI_Tasks\\MEAN\\Angular\\Day5\\SeetourUI\\src\\app\\component\\upload-images\\upload-images.component.html"],"sourcesContent":["import { Component } from '@angular/core';\nimport { AbstractControl, FormBuilder, FormGroup, ValidationErrors, ValidatorFn, Validators } from '@angular/forms';\nimport { HttpClient } from '@angular/common/http';\n\n@Component({\n  selector: 'app-upload-images',\n  templateUrl: './upload-images.component.html',\n  styleUrls: []\n})\nexport class UploadImagesComponent {\n  fileInput = document.querySelector('#fileInput') as HTMLInputElement;\n  files = this.fileInput?.files;\n  readonly maxFileSize = 1; // MB\n  readonly allowedExtensions = [\".jpg\", \".jpeg\", \".png\", \".gif\", \".bmp\"];\n  uploadForm: FormGroup;\n  fileSizeExceeded = false;\n  invalidExtensions = false;\n\n  constructor(private http: HttpClient, private formBuilder: FormBuilder) {\n    this.uploadForm = this.formBuilder.group({\n      fileInput: ['', [\n        Validators.required\n      ]]\n    });\n  }\n\n  onSubmit() {\n    const fileInput = document.querySelector('#fileInput') as HTMLInputElement;\n    const files = fileInput?.files as FileList;\n    if (!files) {\n      console.log('No Selected Files');\n      return;\n    }\n  \n    const formData = new FormData();\n    for (let i = 0; i < files.length; i++) {\n      const file = files.item(i);\n      formData.append('files[]', file as Blob, file?.name);\n    }\n  \n    this.http.post('https://localhost:7277/api/AzureImagesURL/UploadImages', formData)\n      .subscribe((result: any) => {\n        console.log(result);\n        // Reset the form after successful upload\n        this.uploadForm.reset();\n      }, (error: any) => {\n        console.error(error);\n        // Display user-friendly error message here\n      });\n  }\n\n  private fileSizeValidator(): ValidatorFn {\n    return (control: AbstractControl): { [key: string]: boolean } | null => {\n      const files = control.value;\n      if (files && files.length > 0) {\n        for (let i = 0; i < files.length; i++) {\n          const file = files[i];\n          if (file && file.size > this.maxFileSize * 1024 * 1024) {\n            this.fileSizeExceeded = true;\n            return { 'fileSizeExceeded': true };\n          }\n        }\n      }\n      this.fileSizeExceeded = false;\n      return null;\n    };\n  }\n\n  private fileExtensionValidator(allowedExtensions: string[]): ValidatorFn {\n    return (control: AbstractControl): ValidationErrors | null => {\n      const files = control.value as File[];\n      if (!files) {\n        return null;\n      }\n      for (const file of files) {\n        const fileName = file.name;\n        const fileExtension = fileName.split('.').pop()?.toLowerCase();\n        if (fileExtension && allowedExtensions.indexOf('.' + fileExtension) === -1) {\n          return { invalidExtension: true };\n        }\n      }\n      return null;\n    }\n  }\n  \n  validateFiles() {\n    const fileInput = document.querySelector('#fileInput') as HTMLInputElement;\n    const files = fileInput?.files as FileList;\n    if (!files) {\n      return;\n    }\n    for (let i = 0; i < files.length; i++) {\n      const file = files.item(i);\n      const fileName = file?.name;\n      const fileSize = file?.size / 1024 / 1024; // Convert bytes to MB\n      const fileExtension = fileName?.split('.').pop()?.toLowerCase();\n  \n      if (fileSize > this.maxFileSize) {\n        this.fileSizeExceeded = true;\n        return;\n      }\n  \n      if (fileExtension && this.allowedExtensions.indexOf('.' + fileExtension) === -1) {\n        this.invalidExtensions = true;\n        return;\n      }\n    }\n    this.fileSizeExceeded = false;\n    this.invalidExtensions= false;\n  }\n  \n\n}\n\n  ","<form [formGroup]=\"uploadForm\" (ngSubmit)=\"onSubmit()\">\n  <div>\n    <label for=\"fileInput\">Choose file:</label>\n    <input type=\"file\" id=\"fileInput\" name=\"fileInput\" multiple formControlName=\"fileInput\" (change)=\"validateFiles()\">\n    <div *ngIf=\"fileSizeExceeded\">File size exceeded {{ maxFileSize }} MB</div>\n    <div *ngIf=\"invalidExtensions\">Invalid file extensions. Allowed extensions: {{ allowedExtensions.join(', ') }}</div>\n  </div>\n  <button type=\"submit\" [disabled]=\"!uploadForm.valid\">Submit</button>\n</form>\n\n\n\n  \n  <div *ngIf=\"uploadedUrls.length > 0\" >\n    <div *ngFor=\"let image of uploadedUrls\">\n\n        <img  [src]=\"image.url\" />\n      </div>\n    </div>\n  "]},"metadata":{},"sourceType":"module","externalDependencies":[]}